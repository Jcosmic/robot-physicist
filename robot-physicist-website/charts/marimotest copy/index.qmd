---
title: "Histograma Interactivo con API y Plotly"
format: html
filters:
  - marimo
---

## Análisis de Posts con API

Este ejemplo usa la API de JSONPlaceholder para analizar la distribución de longitudes de títulos de posts con Marimo.

```python {.marimo}
import marimo as mo
```

```python {.marimo}
#| echo: false
# Control deslizante para número de bins
just_a_slider = mo.ui.slider(5, 50, value=20, step=5, label="Número de bins:")
just_a_slider
```

```python {.marimo}
import requests
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
```

```python {.marimo}
# Obtener posts de la API
url = "https://jsonplaceholder.typicode.com/posts"
response = requests.get(url)
posts = response.json()

# Crear DataFrame
df = pd.DataFrame(posts)

# Calcular longitud de títulos
df['longitud_titulo'] = df['title'].str.len()

mo.md(f"**Total de posts obtenidos:** {len(df)}")
```

```python {.marimo}
# Mostrar tabla con primeros registros
mo.ui.table(df[['userId', 'title', 'longitud_titulo']].head(10))
```

## Histograma de Longitud de Títulos

```python {.marimo}
fig = px.histogram(
    df, 
    x='longitud_titulo',
    nbins=20,
    title='Distribución de Longitud de Títulos de Posts',
    labels={'longitud_titulo': 'Longitud del Título (caracteres)', 
            'count': 'Frecuencia'},
    color_discrete_sequence=['#636EFA']
)

fig.update_layout(
    xaxis_title='Longitud del Título (caracteres)',
    yaxis_title='Número de Posts',
    hovermode='x unified',
    showlegend=False
)

mo.ui.plotly(fig)
```

## Selector Interactivo de Bins

```python {.marimo}
# Control deslizante para número de bins
bins_slider = mo.ui.slider(
    start=5, 
    stop=50, 
    value=20, 
    step=5,
    label="Número de bins:"
)
bins_slider
```

```python {.marimo}
# Histograma que responde al slider
fig_interactive = px.histogram(
    df, 
    x='longitud_titulo',
    nbins=bins_slider.value,
    title=f'Distribución con {bins_slider.value} bins',
    labels={'longitud_titulo': 'Longitud del Título', 
            'count': 'Frecuencia'},
    color_discrete_sequence=['#FF6B6B']
)

fig_interactive.update_layout(
    xaxis_title='Longitud del Título (caracteres)',
    yaxis_title='Número de Posts',
    hovermode='x unified'
)

mo.ui.plotly(fig_interactive)
```

## Histograma por Usuario

```python {.marimo}
posts_por_usuario = df['userId'].value_counts().sort_index()

fig2 = go.Figure(data=[
    go.Bar(
        x=posts_por_usuario.index,
        y=posts_por_usuario.values,
        marker_color='lightseagreen',
        hovertemplate='Usuario: %{x}<br>Posts: %{y}<extra></extra>'
    )
])

fig2.update_layout(
    title='Número de Posts por Usuario',
    xaxis_title='ID de Usuario',
    yaxis_title='Cantidad de Posts',
    xaxis=dict(tickmode='linear')
)

mo.ui.plotly(fig2)
```

## Estadísticas Descriptivas

```python {.marimo}
stats = df['longitud_titulo'].describe()

mo.md(f"""
**Estadísticas de longitud de títulos:**

- Media: {stats['mean']:.2f} caracteres
- Mediana: {stats['50%']:.2f} caracteres
- Desviación estándar: {stats['std']:.2f}
- Mínimo: {stats['min']:.0f} caracteres
- Máximo: {stats['max']:.0f} caracteres
- Moda: {df['longitud_titulo'].mode()[0]} caracteres
""")
```

## Conclusiones

Los histogramas muestran que la mayoría de los títulos tienen entre 40 y 70 caracteres. Cada usuario tiene exactamente 10 posts en la base de datos. Con Marimo podemos ajustar dinámicamente el número de bins para explorar mejor la distribución.